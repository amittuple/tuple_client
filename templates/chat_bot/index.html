<!--<html>-->
<!--<body>-->
<!--{% load static %}-->
<!--<link rel="stylesheet" type="text/css" href="{% static 'tuple_mia/css/reset.css' %}" />-->
<!--<link rel="stylesheet" type="text/css" href="{% static 'tuple_mia/css/index.css' %}"/>-->
<!--<div class="container">-->
			<!--<div id ='foo'>-->
				<!--<div class="panel-heading text-center">-->
					<!--<button class="title" href="javascript:;" onclick=show_1() >chat with tuple-mia</button>-->
							<!--</div>-->
						<!--<div id="expand">-->
						<!--<div class="chat"></div>-->
						<!--<div class="busy"></div>-->
						<!--<div class="input">-->
							<!--<input type="text" placeholder="Chat with me!" >-->
							<!--<a >Send</a>-->
							<!--{% load banana_tags %}-->
							<!--<div style="display: none">-->
							<!--<form action="/am/mailchimp/" method="GET">-->
    							<!--<input type="submit" type="hidden" value="Go to mailchimp" id="demo1" />-->
							<!--</form>-->
								<!--<form action="/dashboard/" method="GET">-->
    							<!--<input type="submit" type="hidden" id="demo2"/>-->
							<!--</form>-->
								<!--</div>-->
							<!--</div>-->
						<!--</div>-->
				<!--</div>-->
			<!--</div>-->
		<!--</div>-->

<!--<script src="{% static 'tuple_mia/java_script/index.js' %}"></script>-->
<!--<script src="{% static 'tuple_mia/java_script/chat-bot.js' %}"></script>-->
<!--<script src="{% static 'tuple_mia/java_script/jquery-1.7.2.js' %}"></script>-->
<!--<script src="{% static 'tuple_mia/java_script/expand_div.js' %}"></script>-->

<!--</body>-->
<!--</html>-->

{% load static %}
<html>
	<head>
		<title>chat-bot</title>
		<link rel="stylesheet" type="text/css" href="{% static 'tuple_mia/css/reset.css' %}" />
		<link rel="stylesheet" type="text/css" href="{% static 'tuple_mia/css/index.css' %}"/>
	</head>
	<body>
		<div class="container">
			<h1 class="title">chat-bot</h1>
			<div class="chat"></div>
			<div class="busy"></div>
			<div class="input">
				<input type="text" placeholder="Chat with me!" />
				<a>Send</a>
			</div>
		</div>
		<script type="text/javascript" src="{% static 'tuple_mia/java_script/jquery-1.7.2.js' %}"></script>
	<script>
	var you = 'You';
	var robot = 'Buddy';
	var delayStart = 400;
	var delayEnd = 800;
	var bot = new chatBot();
	var chat = $('.chat');
	var waiting = 0;
	$('.busy').text(robot + ' is typing...');
    var submitChat = function() {
		var input = $('.input input').val();
		if(input == '') return;
		$('.input input').val('');
		updateChat(you, input);
		var reply = bot.respondTo(input);
		if(reply == null) return;
		var latency = Math.floor((Math.random() * (delayEnd - delayStart)) + delayStart);
		$('.busy').css('display', 'block');
		waiting++;
		setTimeout( function() {
			if(typeof reply === 'string') {
				updateChat(robot, reply);
			} else {
				for(var r in reply) {
					updateChat(robot, reply[r]);
				}
			}
			if(--waiting == 0) $('.busy').css('display', 'none');
		}, latency);
	}
	var updateChat = function(party, text) {
		var style = 'you';
		if(party != you) {
			style = 'other';
		}
		var line = $('<div><span class="party"></span> <span class="text"></span></div>');
		line.find('.party').addClass(style).text(party + ':');
		line.find('.text').text(text);
		chat.append(line);
		chat.stop().animate({ scrollTop: chat.prop("scrollHeight")});
	}
	$('.input').bind('keydown', function(e) {
		if(e.keyCode == 13) {
			submitChat();
		}
	});
	$('.input a').bind('click', submitChat);
	updateChat(robot, 'Hi there. Try typing something!');
	function chatBot()
	{
	this.input;
	this.respondTo = function(input) {
		function myfunction() {
			alert('hi');
			var robot = 'Buddy';
			alert(input);
			st = ''
			for(i=0; i<input.length; i++) {

				if (input[i] == 'high')
					temp = '> 70000'
				else
				if(input[i] == '<')
					temp = 'lt'
				else
				if (input[i] == '>')
					temp = 'gt'
				else
				if (input[i] == '=')
					temp = 'eq'
				else
				if(input[i] == ' ')
					temp = '-'
				else temp = input[i]
				st = st + temp
				}
				alert(st)
        $.ajax({
        url: '/am/reply/'+st,
        type: 'GET',
        dataType: 'text',
        contentType: "application/text; charset=utf-8",
        success: function(response) {
                   alert('the responce is:'+response);
			updateChat(robot, response);
			alert('special');
            },
			failure: function(errMsg) {
            alert(errMsg);
        }
        });
		}
		myfunction();
    this.match = function(regex) {
		return new RegExp(regex).test(this.input);
	}
}
</script>

	</body>
</html>